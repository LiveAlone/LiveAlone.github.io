---
title: 微服务监控排查
tags:
  - Monitor
  - Basic
categories:
  - 技术
  - 监控
date: 2020-09-07 15:55:09
---


微服务环境下服务之间的依赖变弱，会有防止雪崩，熔断降级策略。同时业务发布回滚策略处理方式。 服务一般部署在虚拟机，容器中，serverless 函数式部署等等。服务经常遇到问题，超时，异常，不可用，阻塞等等。 大概分为业务异常， 业务异常引起的资源服务异常，底层资源服务本身有问题。 监控服务时间状态， 遇到问题，通过登录虚拟机，容器中， 查看虚拟容器的实时参数，判断问题来源, 这样一般可以定位表面原因, 临时处理，但是对于定位问题来源，影响时间困难。历史状态监控工具, 定位异常发生时间，定位问题来源，分析异常产生的比例等等。需要基础设施的支持。

- 实时监控, 相对简单，不需要存储
  - 资源监控，登录虚拟机，容器，监控内存，CPU, 网络，磁盘 实时统计数据信息。
  - 业务 proecss 通常暴露监控的数据接口， spring actuator 端口获取监控数据。 arthas 业务参数实时调用监控统计。
  - 火焰图很好工具，应用火焰图，资源火焰图等。 快速定位问题产生位置。
- 历史监控, 通常数据存户7天(es 日志数据存储，promethus 监控数据存储，CAT hive 数据存储)
  - 日志存储定位
    - ELK 日志系统，通常定位 业务异常，process 服务进程异常，特殊用户异常， 过滤定位特殊请求异常。
    - CAT 对服务业务实时统计，**统计**很重要，不同服务依赖 99 线，异常问题数量统计，具体实例的错误比率等。
    - SKY WALKING 用来追踪调用链路，对于延时比较高，跨服务很多的， 追踪调用耗时链。
  - endpoint 落库实时监控数据 (influxdb promethus)
    - 系统监控， CPU 使用率， 内存使用率，网路输入输出流量，包数量，链接数量，内存分配数量等等。
    - java 服务来说 jvm 监控， old gc 次数，耗时, 不同带的内存大小，占比，线程数量， 直接内存大小等等。
    - redis ops 数量，分类统计，内存使用数量， 主从同步情况，输入输出流量，线程数量， 客户端链接数量等等
    - envoy, golang 等等 不同 process, 协程，耗时 等等监控。
    - 业务服务来说，接口请求量，错误率，延时(不同比率延时)。 依赖的redis mq, mysql, 三方服务， http 等等 错误率，延时，QPS 监控。

个人统计了一些基础监控方式，使用过的，后面想对实时监控命令进行梳理。
